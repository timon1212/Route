<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Offline iPad Route Manager</title>
<style>
/* === General UI Styles === */
body{margin:0;font-family:Helvetica, Arial, sans-serif;background:#f5f5f7;color:#222;}
header{background:#4a90e2;color:white;padding:20px;text-align:center;font-size:26px;font-weight:bold;box-shadow:0 2px 4px rgba(0,0,0,0.1);}
.container{max-width:800px;margin:0 auto;padding:10px;}
.card{background:white;padding:15px;margin:10px 0;border-radius:12px;box-shadow:0 4px 8px rgba(0,0,0,0.08);}
button{padding:12px 16px;margin:4px;border:none;border-radius:6px;background:#4a90e2;color:white;cursor:pointer;font-size:14px;}
button:hover{background:#357ABD;}
input, select, textarea{width:100%;padding:8px;margin:4px 0;border-radius:6px;border:1px solid #ccc;box-sizing:border-box;font-size:14px;}
#mapCanvas{border:1px solid #ccc;border-radius:12px;width:100%;height:400px;margin:10px 0;}
.table-container{overflow-x:auto;}
table{border-collapse:collapse;width:100%;margin-top:10px;}
th, td{border:1px solid #ccc;padding:8px;text-align:left;font-size:14px;}
th{background:#eee;}
.status-complete{color:green;font-weight:bold;}
.status-pending{color:#e67e22;font-weight:bold;}
.theme-toggle{position:fixed;top:10px;right:10px;padding:10px;background:#222;color:white;border-radius:6px;z-index:999;}
</style>
</head>
<body>
<header>ðŸšš Offline iPad Route Manager</header>
<div class="container">

<!-- Theme Toggle -->
<button class="theme-toggle" onclick="toggleTheme()">Toggle Dark Mode</button>

<!-- Add Location Form -->
<div class="card">
<h3>Add New Location</h3>
<label>Stop Name</label><input type="text" id="stopName">
<label>Address / Notes</label><textarea id="stopAddress"></textarea>
<label>Category</label><input type="text" id="stopCategory" placeholder="Delivery, Fuel, Service">
<label>Priority</label>
<select id="stopPriority">
<option value="Low">Low</option>
<option value="Medium">Medium</option>
<option value="High">High</option>
</select>
<button onclick="addStop()">Add Location</button>
</div>

<!-- Map Canvas -->
<canvas id="mapCanvas"></canvas>

<!-- Route Controls -->
<div class="card">
<h3>Route Controls</h3>
<button onclick="calculateRoute()">Optimize Route</button>
<button onclick="startRoute()">Start Route Timer</button>
<button onclick="pauseRoute()">Pause Timer</button>
<button onclick="resetRoute()">Reset Timer</button>
<p>Total Estimated Time: <span id="totalTime">0</span> mins</p>
<p>Route Status: <span id="routeStatus">Not started</span></p>
</div>

<!-- Locations Table -->
<div class="card table-container">
<h3>Stops</h3>
<table id="stopsTable">
<tr><th>Name</th><th>Address</th><th>Category</th><th>Priority</th><th>Status</th><th>Actions</th></tr>
</table>
</div>

<!-- Export -->
<div class="card">
<button onclick="exportCSV()">Export Route CSV</button>
</div>

</div>
<script>
// === Offline Data Storage ===
var stops = JSON.parse(localStorage.getItem('stops')||'[]');
var routeOrder = [];
var routeTimer=null;
var routeElapsed=0;
var darkMode=false;

// === Utility Functions ===
function saveStops(){localStorage.setItem('stops',JSON.stringify(stops));renderStops();}
function addStop(){
 var name=document.getElementById('stopName').value;
 var address=document.getElementById('stopAddress').value;
 var category=document.getElementById('stopCategory').value;
 var priority=document.getElementById('stopPriority').value;
 if(!name){alert('Stop name required'); return;}
 stops.push({name:name,address:address,category:category,priority:priority,status:'Pending',lat:Math.random()*25+25,lng:Math.random()*-125+70}); // mock coords
 saveStops();
 document.getElementById('stopName').value='';
 document.getElementById('stopAddress').value='';
 document.getElementById('stopCategory').value='';
}
function renderStops(){
 var table=document.getElementById('stopsTable'); table.innerHTML='<tr><th>Name</th><th>Address</th><th>Category</th><th>Priority</th><th>Status</th><th>Actions</th></tr>';
 for(var i=0;i<stops.length;i++){
  var s=stops[i];
  var tr=document.createElement('tr');
  tr.innerHTML='<td>'+s.name+'</td><td>'+s.address+'</td><td>'+s.category+'</td><td>'+s.priority+'</td><td class="'+(s.status==='Complete'?'status-complete':'status-pending')+'">'+s.status+'</td>'+
  '<td><button onclick="editStop('+i+')">Edit</button> <button onclick="deleteStop('+i+')">Delete</button></td>';
  table.appendChild(tr);
 }
 drawMap();
}
function editStop(i){
 var s=stops[i];
 var name=prompt('Edit Name',s.name);
 if(name!==null)s.name=name;
 var address=prompt('Edit Address/Notes',s.address);
 if(address!==null)s.address=address;
 var category=prompt('Edit Category',s.category);
 if(category!==null)s.category=category;
 var priority=prompt('Edit Priority',s.priority);
 if(priority!==null)s.priority=priority;
 saveStops();
}
function deleteStop(i){if(confirm('Delete this stop?')){stops.splice(i,1);saveStops();}}

// === Route Optimization (Offline AI) ===
function calculateRoute(){
 if(stops.length===0){alert('Add stops first'); return;}
 // Simple greedy nearest neighbor mock using lat/lng
 var remaining=stops.slice(); var route=[];
 var current=remaining.shift(); route.push(current);
 while(remaining.length>0){
   var nearestIndex=0; var nearestDist=distance(current,remaining[0]);
   for(var i=1;i<remaining.length;i++){
     var d=distance(current,remaining[i]); if(d<nearestDist){nearestDist=d;nearestIndex=i;}
   }
   current=remaining.splice(nearestIndex,1)[0]; route.push(current);
 }
 routeOrder=route; updateStopOrder(); alert('Route optimized!');
}
function distance(a,b){var dx=a.lat-b.lat; var dy=a.lng-b.lng; return Math.sqrt(dx*dx+dy*dy);}
function updateStopOrder(){
 for(var i=0;i<stops.length;i++)stops[i].status='Pending';
 renderStops();
 var total=stops.length*5+(stops.length-1)*30; document.getElementById('totalTime').innerText=total;
}

// === Timer Functions ===
function startRoute(){if(routeTimer)return; routeTimer=setInterval(function(){routeElapsed++;document.getElementById('routeStatus')='Running'},60000);}
function pauseRoute(){if(routeTimer){clearInterval(routeTimer);routeTimer=null;document.getElementById('routeStatus').innerText='Paused';}}
function resetRoute(){routeElapsed=0;pauseRoute();document.getElementById('routeStatus').innerText='Not started';}

// === Export CSV ===
function exportCSV(){
 if(stops.length===0){alert('No stops'); return;}
 var csv='Name,Address,Category,Priority,Status\n';
 for(var i=0;i<stops.length;i++){
  var s=stops[i]; csv+='"'+s.name+'","'+s.address+'","'+s.category+'","'+s.priority+'","'+s.status+'"\n';
 }
 var blob=new Blob([csv],{type:'text/csv'}); var link=document.createElement('a'); link.href=window.URL.createObjectURL(blob); link.download='route.csv'; link.click();
}

// === Map Drawing ===
var canvas=document.getElementById('mapCanvas'); var ctx=canvas.getContext('2d');
function drawMap(){
 ctx.clearRect(0,0,canvas.width,canvas.height);
 // Draw US rectangle as placeholder map
 ctx.fillStyle='#cce5ff'; ctx.fillRect(0,0,canvas.width,canvas.height);
 ctx.fillStyle='#000';
 ctx.font='12px Arial'; ctx.fillText('US Map (Offline Placeholder)',10,20);
 // Draw stops
 for(var i=0;i<stops.length;i++){
   var s=stops[i];
   var x=s.lng*canvas.width/60+canvas.width*0.1; // rough mock coords
   var y=s.lat*canvas.height/50; ctx.beginPath(); ctx.arc(x,y,6,0,2*Math.PI); ctx.fillStyle=(s.status==='Complete'?'green':'red'); ctx.fill();
   ctx.fillText(s.name,x+8,y+4);
 }
}

// === Theme Toggle ===
function toggleTheme(){darkMode=!darkMode;document.body.style.background=darkMode?'#222':'#f5f5f7';document.body.style.color=darkMode?'#fff':'#222';}

// === Initialize ===
renderStops();
</script>
</body>
</html>
